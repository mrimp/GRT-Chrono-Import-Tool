<!DOCTYPE html>
<!--
GRT Importer (Standard) v0.80 ‚Äî Release
Build date: 2025-12-12

Changes in this build:
- Export filename uses base .grtload stem + timestamp (YYYYMMDD_HHMM), no seconds.
- Fix: grtBaseFilename TDZ crash (single declaration, no pre-use assignments).
- Fix: Ladder UI clears/locks until a base .grtload with a real ladder (2+ steps) is loaded.
- Fix: Start New Session fully resets ladder state + re-applies ladder visibility/lock state.

Notes:
- localStorage keys are namespaced (xqa_*).
- Expected state (no base loaded) is not an error.
-->


<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>GRT Importer Standard v0.80</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
        :root {
            --grt-bg: #10141c;
            --grt-panel: #1b2431;
            --grt-panel-soft: #151d28;
            --grt-highlight: #273347;
            --grt-border: #3a4a61;
            --grt-border-soft: #283447;
            --grt-accent: #3c86c7;
            --grt-accent-soft: #295f90;
            --grt-accent-warm: #e0a542;
            --grt-text-soft: #c7d2e5;
            --grt-text-subtle: #9ca9c0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
                Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--grt-bg);
        }
        .bg-grt-panel { background-color: var(--grt-panel); }
        .bg-grt-panel-soft { background-color: var(--grt-panel-soft); }
        .bg-grt-highlight { background-color: var(--grt-highlight); }
        .border-grt-frame { border-color: var(--grt-border); }
        .border-grt-soft { border-color: var(--grt-border-soft); }
        .border-grt-accent { border-color: var(--grt-accent); }
        .text-grt-soft { color: var(--grt-text-soft); }
        .text-grt-subtle { color: var(--grt-text-subtle); }

        /* Floating toast container */
        #statusArea {
            position: fixed;
            right: 1rem;
            bottom: 1rem;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-width: 20rem;
            pointer-events: none;
        }
    
        /* Stepper circles for top progress indicator */
        .step-circle {
            height: 1.25rem;
            width: 1.25rem;
            border-radius: 9999px;
            border: 1px solid var(--grt-border-soft);
            background: transparent;
            color: var(--grt-text-subtle);
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            position: relative;
            transform-origin: center;
            transition:
                background-color 0.18s ease,
                border-color 0.18s ease,
                color 0.18s ease,
                transform 0.18s ease,
                box-shadow 0.18s ease;
        }
        .step-circle--active {
            border-color: var(--grt-accent);
            background: var(--grt-highlight);
            color: var(--grt-text-soft);
            transform: scale(1.05);
        }
        .step-circle--done {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.16);
            color: #bbf7d0;
        }
        .step-circle--done::after {
            content: "‚úì";
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            opacity: 0.25;
            pointer-events: none;
        }

    
        /* Animated active step circle */
        .step-circle--active {
            animation: pulseStep 1.2s infinite ease-in-out;
        }
        @keyframes pulseStep {
            0% { transform: scale(1.05); box-shadow: 0 0 0 0 rgba(60,134,199,0.6); }
            70% { transform: scale(1.12); box-shadow: 0 0 10px 6px rgba(60,134,199,0); }
            100% { transform: scale(1.05); box-shadow: 0 0 0 0 rgba(60,134,199,0); }
        }

        /* Session complete pulse for header pill + stepper */
        .session-pulse {
            animation: sessionPulse 0.45s ease-out;
        }
        @keyframes sessionPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.85);
            }
            100% {
                box-shadow: 0 0 0 14px rgba(34, 197, 94, 0);
            }
        }



/* v094: file input button visibility */
input[type="file"]{color:inherit;}
input[type="file"]::file-selector-button{
  background: rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.92);
  border: 1px solid rgba(255,255,255,0.18);
  border-radius: 12px;
  padding: 10px 14px;
  margin-right: 14px;
  cursor: pointer;
}
input[type="file"]::file-selector-button:hover{background: rgba(255,255,255,0.12);}
input[type="file"]::file-selector-button:active{background: rgba(255,255,255,0.16);}
</style>
</head>
<body class="min-h-screen p-4 md:p-6">
<main class="max-w-5xl mx-auto">
<!-- Header -->
<div class="bg-grt-panel rounded-2xl shadow-2xl p-6 mb-4 border border-grt-frame">
<div class="flex items-start justify-between gap-4">
<div>
<div class="inline-flex items-center gap-2 mb-2">
<span class="inline-flex items-center px-2 py-0.5 rounded-full bg-grt-highlight border border-grt-accent text-[10px] font-semibold tracking-wide uppercase text-grt-soft">
                            Chronograph ‚Üí GRT
                        </span>
</div>
<h1 class="text-3xl md:text-4xl font-extrabold text-white mb-1">
                        GARMIN / ATHLON ‚Üí GRT Importer
                    </h1>
<p class="text-grt-soft text-sm md:text-base">
                        Import chronograph data (Garmin Xero C1 Pro or Athlon Rangecraft Velocity Pro)
                        into Gordon's Reloading Tool projects.
                    </p>
<!-- Quick start line -->
<p class="text-grt-subtle text-[11px] mt-1">
                        Quick start: 1) Load base <code class="bg-slate-800/70 px-1 rounded">.grtload</code> (optional),
                        2) pick chrono + files, 3) download <code class="bg-slate-800/70 px-1 rounded">.grtload</code> and open in GRT.
                    </p>
<div class="flex flex-wrap items-center gap-2 mt-2 text-xs">
<p class="text-grt-subtle">
                            GRT Importer Standard v0.80 ‚Ä¢ XquiziT Arms
                        </p>
<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full border border-grt-soft bg-grt-panel-soft text-[10px] md:text-[11px] text-grt-soft" id="sessionPill" title="Summary of imported sessions and current velocity unit.">
                            ‚öôÔ∏è Standard ‚Ä¢ 0 files ‚Ä¢ ft/s
                        </span>
</div>
</div>
<div class="flex flex-col items-end gap-3">
<div class="flex items-center gap-2">
<button aria-label="Start new session" class="p-2.5 rounded-full bg-grt-panel-soft hover:bg-grt-highlight text-slate-100 border border-grt-frame shadow-md transition-transform transform hover:-translate-y-0.5 hover:shadow-lg" id="newSessionBtn" title="Start new session">
<svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4.5 12a7.5 7.5 0 0112.62-5.303L19.5 9M7.5 9H4.5V6m15 6a7.5 7.5 0 01-12.62 5.303L4.5 15m12 0h3v3" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
</button>
</div>
</div>

<div class="hidden md:flex items-start justify-end">
    <button id="helpOverlayButton"
            class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-grt-frame text-grt-soft text-[11px] md:text-xs bg-grt-panel-soft hover:border-grt-accent hover:text-grt-accent transition">
        <span>‚ùì How to use this</span>
    </button>
</div>
</div>
</div>

<!-- Stepper -->
<div class="mb-4 md:mb-5">
<ol class="flex items-center gap-2 text-[11px] md:text-xs text-grt-subtle" id="topStepper">
<li class="flex items-center gap-1" data-step="1">
<div class="step-circle step-circle--active">
                        1
                    </div>
<span>Load base .grtload</span>
</li>
<li class="flex-1 h-px bg-grt-highlight/60 mx-1"></li>
<li class="flex items-center gap-1" data-step="2">
<div class="step-circle">
                        2
                    </div>
<span>Chronograph files</span>
</li>
<li class="flex-1 h-px bg-grt-highlight/30 mx-1"></li>
<li class="flex items-center gap-1" data-step="3">
<div class="step-circle">
                        3
                    </div>
<span>Pictures &amp; notes</span>
</li>
<li class="flex-1 h-px bg-grt-highlight/30 mx-1"></li>
<li class="flex items-center gap-1" data-step="4">
<div class="step-circle">
                        4
                    </div>
<span>Review &amp; download</span>
</li>
</ol>
</div>
<!-- Floating status toasts --><!-- Floating status toasts -->
<div aria-live="polite" id="statusArea" role="status"></div>
<!-- Upload Area -->
<section aria-label="Import configuration" class="space-y-4 md:space-y-5" id="uploadArea" title="Configure device, units, and import mode, then load your chrono files.">
<!-- 1. GRT Base File -->
<div class="bg-grt-panel rounded-2xl shadow-xl p-5 md:p-6 border border-grt-frame hover:border-grt-accent transition-colors">
<div class="flex items-start gap-4">
<div class="flex-shrink-0 w-10 h-10 md:w-12 md:h-12 bg-grt-highlight rounded-full flex items-center justify-center text-lg md:text-xl font-bold text-grt-soft border border-grt-accent shadow-inner">
                        1
                    </div>
<div class="flex-1">
<h3 class="text-lg font-bold text-white mb-1.5">
                            üìÅ Load GRT Base File (Optional)
                        </h3>
<p class="text-grt-soft text-xs md:text-sm mb-4">
                            Upload an existing <code class="text-slate-200 bg-slate-800/80 px-1 py-0.5 rounded text-[11px]">.grtload</code>
                            with your rifle, ammo, and powder configuration. Your original tabs and ladder remain untouched.
                            Standard mode creates an <strong>Imported Measurement</strong> tab; Ladder mode creates an
                            <strong>Imported Ladder</strong> tab.
                        </p>
<div class="flex flex-wrap items-center gap-3">
<input accept=".grtload,.grt" class="hidden" id="grtBaseInput" title="Optional: choose a base .grtload file to merge ladder data into." type="file"/>
<button class="px-4 py-2 bg-grt-panel-soft hover:bg-grt-highlight text-white rounded-lg text-sm font-medium border border-grt-frame shadow-sm transition-colors" id="grtBaseBtn" onclick="document.getElementById('grtBaseInput').click()" title="Browse for the base .grtload file used for ladder imports.">
                                Select .grtload
                            </button>
<span class="text-emerald-300 text-xs md:text-sm" id="grtBaseStatus"></span>
</div>
</div>
</div>
</div>
<!-- 2. Chronograph Files -->
<div class="bg-grt-panel rounded-2xl shadow-xl p-5 md:p-6 border border-grt-frame hover:border-grt-accent transition-colors">
<div class="flex items-start gap-4">
<div class="flex-shrink-0 w-10 h-10 md:w-12 md:h-12 bg-grt-highlight rounded-full flex items-center justify-center text-lg md:text-xl font-bold text-grt-soft border border-grt-accent shadow-inner">
                        2
                    </div>
<div class="flex-1">
<h3 class="text-lg font-bold text-white mb-1.5">üéØ Load Chronograph Files</h3>
<p class="text-grt-soft text-xs md:text-sm mb-4">
                            Load chronograph data as CSV or Excel files
                            (<code class="text-slate-200 bg-slate-800/80 px-1 py-0.5 rounded text-[11px]">.csv</code>,
                             <code class="text-slate-200 bg-slate-800/80 px-1 py-0.5 rounded text-[11px]">.xls</code>,
                             <code class="text-slate-200 bg-slate-800/80 px-1 py-0.5 rounded text-[11px]">.xlsx</code>),
                            then pick device, file unit, and import mode.
                        </p>
<!-- Device / unit / mode -->
<div class="flex flex-col gap-2 mb-4">
<div class="flex flex-wrap items-center gap-2">
<label class="text-grt-soft text-xs md:text-sm font-semibold" for="deviceSelect">
                                    Chronograph:
                                </label>
<select class="px-2.5 py-1.5 rounded-lg bg-grt-panel-soft text-white text-xs md:text-sm border border-grt-frame focus:outline-none focus:ring-2 focus:ring-[var(--grt-accent)] focus:border-[var(--grt-accent)]" id="deviceSelect" title="Choose the chronograph device that produced your files (Garmin or Athlon).">
<option value="garmin">Garmin Xero C1 Pro</option>
<option value="athlon">Athlon Rangecraft Velocity Pro</option>
</select>
</div>
<div class="flex flex-wrap items-center gap-2">
<label class="text-grt-soft text-xs md:text-sm font-semibold" for="unitSelect">
                                    Velocity unit in file:
                                </label>
<select class="px-2.5 py-1.5 rounded-lg bg-grt-panel-soft text-white text-xs md:text-sm border border-grt-frame focus:outline-none focus:ring-2 focus:ring-[var(--grt-accent)] focus:border-[var(--grt-accent)]" id="unitSelect" title="Set the velocity unit that matches your chronograph exports.">
<option value="imperial">Imperial (ft/s)</option>
<option value="metric">Metric (m/s)</option>
</select>
<span class="text-grt-subtle text-[11px] md:text-xs">
                                    GRT always receives m/s; we convert if needed.
                                </span>
</div>
<div class="flex flex-wrap items-center gap-2">
<label class="text-grt-soft text-xs md:text-sm font-semibold" for="modeSelect">
                                    Import mode:
                                </label>
<select class="px-2.5 py-1.5 rounded-lg bg-grt-panel-soft text-white text-xs md:text-sm border border-grt-frame focus:outline-none focus:ring-2 focus:ring-[var(--grt-accent)] focus:border-[var(--grt-accent)]" id="modeSelect" title="Select Standard, Ladder, or Sessions import mode.">
<option value="normal">Standard ‚Üí Imported Measurement</option>
<option value="ladder">Ladder ‚Üí Imported Ladder</option>
<option value="sessions">Sessions - Imported Sessions</option>

</select>
<div class="mt-3 p-3 md:p-4 rounded-xl bg-grt-panel-soft border border-grt-frame">
  <div class="flex flex-col md:flex-row md:items-baseline md:justify-between gap-1 md:gap-3 mb-2">
    <span class="text-grt-soft text-xs md:text-sm font-semibold">Export &amp; GRT options</span>
    <span class="text-grt-subtle text-[10px] md:text-xs">
      Affects what gets written into the next <span class="font-mono">.grtload</span> export.
    </span>
  </div>

  <div class="flex flex-col sm:flex-row sm:flex-wrap gap-3">
    <label class="inline-flex items-center gap-2 text-grt-subtle text-[11px] md:text-xs" title="If enabled, we‚Äôll write extended metrics into the charge notes when exporting.">
      <input id="analysisIncludeInNotes" type="checkbox" class="rounded border-grt-frame bg-grt-panel-soft" />
      <span>Write extended metrics into charge notes</span>
    </label>

    <label class="inline-flex items-center gap-2 text-grt-subtle text-[11px] md:text-xs" title="If enabled, we‚Äôll add the Analysis summary note/tab to the .grtload appendix.">
      <input id="exportAnalysisTab" type="checkbox" class="rounded border-grt-frame bg-grt-panel-soft" />
      <span>Export ‚ÄúAnalysis‚Äù tab (summary note)</span>
    </label>
  </div>

  <div class="mt-2 text-grt-subtle text-[10px] md:text-xs">Remembered on this browser.</div>
</div>
</div>
</div>
<!-- Standard multi-file panel inside drag-and-drop zone -->
